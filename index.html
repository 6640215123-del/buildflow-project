<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuildFlow Pro - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&family=Montserrat:wght@400;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- CSS Variables --- */
        :root {
            --primary: #0056b3;
            --primary-dark: #004494;
            --secondary: #f0f4f8;
            --accent: #ff6b00;
            --text-dark: #333;
            --white: #fff;
            --gray: #ccc;
            --success: #28a745;
            --danger: #ff4d4d;
        }

        /* --- Reset & Base --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background-color: var(--secondary); 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            font-family: 'Sarabun', sans-serif; 
        }

        /* --- Utilities --- */
        .hidden { display: none !important; }
        
        /* --------------------------------------------------- */
        /* --- SLIDING LOGIN CSS (Scoped) --- */
        /* --------------------------------------------------- */
        #login-wrapper {
            position: fixed;
            width: 100%;
            height: 100%;
            background: #f6f5f7;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Montserrat', sans-serif;
        }

        #login-wrapper h1 { font-weight: bold; margin: 0; }
        #login-wrapper p { font-size: 14px; font-weight: 100; line-height: 20px; letter-spacing: 0.5px; margin: 20px 0 30px; }
        #login-wrapper span { font-size: 12px; }
        #login-wrapper a { color: #333; font-size: 14px; text-decoration: none; margin: 15px 0; }
        
        #login-wrapper button {
            border-radius: 20px;
            border: 1px solid var(--primary);
            background-color: var(--primary);
            color: #FFFFFF;
            font-size: 12px;
            font-weight: bold;
            padding: 12px 45px;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: transform 80ms ease-in;
            cursor: pointer;
            margin-top: 10px;
        }

        #login-wrapper button:active { transform: scale(0.95); }
        #login-wrapper button:focus { outline: none; }
        #login-wrapper button.ghost { background-color: transparent; border-color: #FFFFFF; }

        #login-wrapper form {
            background-color: #FFFFFF;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 50px;
            height: 100%;
            text-align: center;
        }

        #login-wrapper input {
            background-color: #eee;
            border: none;
            padding: 12px 15px;
            margin: 8px 0;
            width: 100%;
            font-family: 'Sarabun', sans-serif;
        }

        /* Containers */
        .auth-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
            position: relative;
            overflow: hidden;
            width: 768px;
            max-width: 100%;
            min-height: 480px;
        }

        .form-container {
            position: absolute;
            top: 0;
            height: 100%;
            transition: all 0.6s ease-in-out;
        }

        .sign-in-container { left: 0; width: 50%; z-index: 2; }
        .auth-container.right-panel-active .sign-in-container { transform: translateX(100%); }

        .sign-up-container { left: 0; width: 50%; opacity: 0; z-index: 1; }
        .auth-container.right-panel-active .sign-up-container {
            transform: translateX(100%); opacity: 1; z-index: 5; animation: show 0.6s;
        }

        @keyframes show {
            0%, 49.99% { opacity: 0; z-index: 1; }
            50%, 100% { opacity: 1; z-index: 5; }
        }

        .overlay-container {
            position: absolute;
            top: 0;
            left: 50%;
            width: 50%;
            height: 100%;
            overflow: hidden;
            transition: transform 0.6s ease-in-out;
            z-index: 100;
        }

        .auth-container.right-panel-active .overlay-container { transform: translateX(-100%); }

        .overlay {
            background: var(--primary);
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            background-repeat: no-repeat;
            background-size: cover;
            background-position: 0 0;
            color: #FFFFFF;
            position: relative;
            left: -100%;
            height: 100%;
            width: 200%;
            transform: translateX(0);
            transition: transform 0.6s ease-in-out;
        }

        .auth-container.right-panel-active .overlay { transform: translateX(50%); }

        .overlay-panel {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 40px;
            text-align: center;
            top: 0;
            height: 100%;
            width: 50%;
            transform: translateX(0);
            transition: transform 0.6s ease-in-out;
        }

        .overlay-left { transform: translateX(-20%); }
        .auth-container.right-panel-active .overlay-left { transform: translateX(0); }
        .overlay-right { right: 0; transform: translateX(0); }
        .auth-container.right-panel-active .overlay-right { transform: translateX(20%); }

        .social-container { margin: 20px 0; }
        .social-container a {
            border: 1px solid #DDDDDD;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 0 5px;
            height: 40px;
            width: 40px;
            cursor: pointer; /* Change cursor on hover */
            transition: 0.2s;
        }
        .social-container a:hover {
            background-color: #f0f0f0;
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Loading Spinner */
        #loading-overlay {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(255,255,255,0.95); 
            z-index: 500; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--primary);
            border-radius: 10px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


        /* --------------------------------------------------- */
        /* --- MAIN APP CSS (Existing) --- */
        /* --------------------------------------------------- */
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; display: inline-flex; align-items: center; gap: 5px; font-family: 'Sarabun', sans-serif;}
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #004494; }
        .btn-outline { border: 1px solid var(--primary); color: var(--primary); background: transparent; }
        .btn-danger { background: var(--danger); color: white; }
        
        .btn-icon { background: none; color: #666; font-size: 1.1rem; padding: 5px; cursor: pointer; border: none; }
        .btn-icon:hover { color: var(--primary); background: #eee; border-radius: 50%; }

        /* Image Delete Badge */
        .img-wrapper { position: relative; display: inline-block; }
        .delete-badge {
            position: absolute; top: -8px; right: -8px; background: var(--danger); color: white;
            border-radius: 50%; width: 22px; height: 22px; display: flex;
            justify-content: center; align-items: center; font-size: 12px; cursor: pointer;
            border: 2px solid white; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .delete-badge:hover { transform: scale(1.1); }
        
        /* Layout */
        #app-container { display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 240px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .brand { font-size: 1.5rem; color: var(--primary); font-weight: bold; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .menu-item { padding: 12px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 12px; transition: 0.2s; cursor: pointer; }
        .menu-item:hover, .menu-item.active { background: var(--secondary); color: var(--primary); font-weight: 600; }
        
        /* Main Content */
        .main-content { flex: 1; padding: 20px; overflow-y: auto; position: relative; }
        .top-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; background: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .project-title h2 { font-size: 1.4rem; color: var(--primary); margin-bottom: 5px; }
        .project-title p { font-size: 0.9rem; color: #777; }

        /* Sections */
        .section-content { display: none; animation: fadeIn 0.3s; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dashboard Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; }
        .stat-card h3 { font-size: 2.5rem; color: var(--primary); margin: 10px 0; }
        .progress-bar-bg { height: 10px; background: #eee; border-radius: 5px; margin-top: 10px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease; }

        /* Task List */
        .task-list { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .task-item { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
        .task-left { display: flex; align-items: center; gap: 15px; flex: 1; }
        .task-name { font-weight: 500; }
        .task-name.completed { text-decoration: line-through; color: #aaa; }
        input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: var(--success); }
        .task-img-thumb { width: 45px; height: 45px; object-fit: cover; border-radius: 5px; cursor: pointer; border: 1px solid #ddd; }

        /* Floor Plan */
        .plan-container { background: white; padding: 20px; border-radius: 10px; text-align: center; min-height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px dashed #ddd; position: relative; }
        .plan-img { max-width: 100%; max-height: 600px; border-radius: 5px; margin-top: 20px; }

        /* Documents */
        .doc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .doc-card { background: white; padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; transition: 0.2s; border: 1px solid #eee; position: relative; }
        .doc-card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .doc-icon { font-size: 3rem; color: #888; margin-bottom: 10px; }
        .card-delete-btn { position: absolute; top: 5px; right: 5px; color: var(--danger); cursor: pointer; padding: 5px; opacity: 0; transition: 0.2s; z-index: 5; }
        .doc-card:hover .card-delete-btn, .photo-card:hover .card-delete-btn { opacity: 1; }

        /* Photo Feed */
        .photo-feed-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .photo-card { height: 120px; background-size: cover; background-position: center; border-radius: 8px; position: relative; cursor: pointer; border: 1px solid #ddd; }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 400px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: 'Sarabun', sans-serif;}

        /* Image Viewer */
        #image-viewer-modal { z-index: 2000; background: rgba(0,0,0,0.9); }
        #image-viewer-content { max-width: 90%; max-height: 90%; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .close-img-btn { position: absolute; top: 20px; right: 20px; color: white; font-size: 2rem; cursor: pointer; }

        @media (max-width: 768px) {
            .sidebar { position: fixed; bottom: 0; width: 100%; height: 70px; flex-direction: row; border-top: 1px solid #ddd; border-right: none; padding: 0; z-index: 100; justify-content: space-around; background: white; }
            .brand, .menu-text { display: none; }
            .menu-item { flex-direction: column; gap: 5px; font-size: 0.8rem; padding: 10px; margin: 0; border-radius: 0; }
            .menu-item i { font-size: 1.4rem; }
            .main-content { padding-bottom: 80px; }
            .top-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            
            /* Responsive Login */
            .auth-container { width: 100%; min-height: 600px; }
            .overlay-container { display: none; } /* Hide overlay on mobile for simplicity */
            .sign-in-container, .sign-up-container { width: 100%; }
            .sign-up-container { opacity: 0; z-index: 1; }
            .auth-container.right-panel-active .sign-up-container { opacity: 1; z-index: 5; transform: none; animation: none;}
            .auth-container.right-panel-active .sign-in-container { opacity: 0; }
        }
    </style>
</head>
<body>

    <input type="file" id="task-photo-input" accept="image/*" hidden onchange="saveTaskPhoto(this)">
    <input type="file" id="doc-upload-input" hidden onchange="handleDocUpload(this)">

    <div id="login-wrapper">
        <div class="auth-container" id="auth-container">
            <div id="loading-overlay" class="hidden">
                <div class="spinner"></div>
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
            </div>

            <div class="form-container sign-up-container">
                <form onsubmit="handleLoginSubmit(event, 'signup-username')">
                    <h1>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</h1>
                    <div class="social-container">
                        <a onclick="mockSocialLogin('Facebook')" class="social"><i class="fab fa-facebook-f"></i></a>
                        <a onclick="mockSocialLogin('Google')" class="social"><i class="fab fa-google"></i></a>
                        <a onclick="mockSocialLogin('LinkedIn')" class="social"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <span>‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</span>
                    <input type="text" id="signup-username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Username)" required />
                    <input type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" />
                    <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
                    <button type="submit">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    <p class="mobile-toggle" style="display:none;" onclick="toggleMobileLogin()">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
                </form>
            </div>

            <div class="form-container sign-in-container">
                <form onsubmit="handleLoginSubmit(event, 'signin-username')">
                    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>
                    <div class="social-container">
                        <a onclick="mockSocialLogin('Facebook')" class="social"><i class="fab fa-facebook-f"></i></a>
                        <a onclick="mockSocialLogin('Google')" class="social"><i class="fab fa-google"></i></a>
                        <a onclick="mockSocialLogin('LinkedIn')" class="social"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <span>‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
                    <input type="text" id="signin-username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Username)" required />
                    <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
                    <a href="#">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
                    <button type="submit">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <p class="mobile-toggle" style="display:none;" onclick="toggleMobileLogin()">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
                </form>
            </div>

            <div class="overlay-container">
                <div class="overlay">
                    <div class="overlay-panel overlay-left">
                        <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö!</h1>
                        <p>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                        <button class="ghost" id="signIn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                    <div class="overlay-panel overlay-right">
                        <h1>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà!</h1>
                        <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</p>
                        <button class="ghost" id="signUp">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="app-container" class="hidden">
        
        <aside class="sidebar">
            <div class="brand"><i class="fas fa-hard-hat"></i> BuildFlow</div>
            <div onclick="switchTab('dashboard')" class="menu-item active" id="nav-dashboard">
                <i class="fas fa-chart-pie"></i> <span class="menu-text">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span>
            </div>
            <div onclick="switchTab('plan')" class="menu-item" id="nav-plan">
                <i class="fas fa-map"></i> <span class="menu-text">‡πÅ‡∏õ‡∏•‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</span>
            </div>
            <div onclick="switchTab('schedule')" class="menu-item" id="nav-schedule">
                <i class="fas fa-tasks"></i> <span class="menu-text">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</span>
            </div>
            <div onclick="switchTab('docs')" class="menu-item" id="nav-docs">
                <i class="fas fa-folder-open"></i> <span class="menu-text">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
            </div>
            <div style="margin-top:auto;" onclick="logout()" class="menu-item">
                <i class="fas fa-sign-out-alt"></i> <span class="menu-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
            </div>
        </aside>

        <main class="main-content">
            
            <div class="top-header">
                <div class="project-title">
                    <h2 id="display-project-name">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h2>
                    <p id="display-last-update">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                </div>
                <div>
                    <button onclick="openSettings()" class="btn btn-outline"><i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</button>
                    <span class="user-badge" style="margin-left:10px; font-weight:bold; color:var(--primary);"><i class="fas fa-user-circle"></i> <span id="display-user">Admin</span></span>
                </div>
            </div>

            <div id="dashboard-section" class="section-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (Auto)</p>
                        <h3 id="display-progress">0%</h3>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" id="progress-bar-fill"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <p>‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                        <h3 id="display-budget">‡∏ø0</h3>
                    </div>
                    <div class="stat-card">
                        <p>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                        <h3 id="display-pending-tasks">0</h3>
                    </div>
                </div>

                <div style="background:white; padding:20px; border-radius:10px;">
                    <h3 style="margin-bottom:15px;">üì∑ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô (Feed)</h3>
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <button onclick="document.getElementById('site-photo').click()" class="btn btn-primary"><i class="fas fa-camera"></i> ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ/‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
                        <input type="file" id="site-photo" accept="image/*" hidden onchange="handlePhotoUpload(this)">
                    </div>
                    <div id="photo-feed" class="photo-feed-grid">
                        </div>
                </div>
            </div>

            <div id="plan-section" class="section-content">
                <div class="plan-container">
                    <div id="no-plan-msg">
                        <i class="fas fa-map" style="font-size:4rem; color:#ddd; margin-bottom:15px;"></i>
                        <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô</h3>
                        <p style="color:#888; margin-bottom:20px;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô (.jpg, .png) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</p>
                        <button onclick="document.getElementById('plan-upload').click()" class="btn btn-primary">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô</button>
                        <input type="file" id="plan-upload" accept="image/*" hidden onchange="handlePlanUpload(this)">
                    </div>
                    <img id="plan-image" class="plan-img hidden">
                    <button onclick="removePlan()" id="remove-plan-btn" class="btn btn-danger hidden" style="margin-top:20px;"><i class="fas fa-trash"></i> ‡∏•‡∏ö‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô</button>
                </div>
            </div>

            <div id="schedule-section" class="section-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (Tasks)</h3>
                    <button onclick="addTaskPrompt()" class="btn btn-primary"><i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
                </div>
                <div class="task-list" id="task-list-container">
                    </div>
            </div>

            <div id="docs-section" class="section-content">
                <div style="margin-bottom:20px;">
                    <button onclick="document.getElementById('doc-upload-input').click()" class="btn btn-primary">
                        <i class="fas fa-file-upload"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                    </button>
                    <p style="font-size:0.8rem; color:red; margin-top:5px;">* ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô Demo ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°</p>
                </div>
                <div class="doc-grid" id="doc-list-container">
                    </div>
            </div>

        </main>
    </div>

    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="margin-bottom:20px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h3>
            <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                <input type="text" id="edit-project-name">
            </div>
            <div class="form-group">
                <label>‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏ö‡∏≤‡∏ó)</label>
                <input type="number" id="edit-project-budget">
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeSettings()" class="btn btn-outline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="saveSettings()" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="image-viewer-modal" class="modal hidden" onclick="closeImageViewer()">
        <span class="close-img-btn">&times;</span>
        <img id="image-viewer-content" src="">
    </div>

    <script>
        // --- DATA STATE (UPDATED FOR EMPTY START) ---
        let appData = {
            user: "",
            projectName: "<‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£>", // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
            budget: 0, // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0
            tasks: [], // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å ‡πÄ‡∏õ‡πá‡∏ô array ‡∏ß‡πà‡∏≤‡∏á
            planImage: null,
            sitePhotos: [],
            documents: []
        };
        
        let currentTaskIndexForUpload = null;

        // --- INIT ---
        function init() {
            // Change Key to v5 to force reset data
            const savedData = localStorage.getItem('buildflow_pro_data_v5');
            if (savedData) {
                try {
                    appData = JSON.parse(savedData);
                } catch(e) { console.error("Data error", e); }
            }
            
            // Check if user is already logged in? 
            if(appData.user) {
                // Uncomment to auto-login
                /*
                document.getElementById('login-wrapper').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                document.getElementById('display-user').innerText = appData.user;
                renderAll();
                */
            }
        }

        // --- LOGIN LOGIC (SIMULATION) ---
        
        const signUpButton = document.getElementById('signUp');
        const signInButton = document.getElementById('signIn');
        const authContainer = document.getElementById('auth-container');

        signUpButton.addEventListener('click', () => {
            authContainer.classList.add("right-panel-active");
        });

        signInButton.addEventListener('click', () => {
            authContainer.classList.remove("right-panel-active");
        });

        // 1. Regular Login
        function handleLoginSubmit(event, inputId) {
            event.preventDefault();
            const usernameInput = document.getElementById(inputId);
            const username = usernameInput.value;
            
            if(!username) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            
            // Simulate Loading
            showLoading(() => {
                loginSuccess(username);
            });
        }

        // 2. Mock Social Login
        function mockSocialLogin(provider) {
            // Show Loading
            showLoading(() => {
                // Determine mock name
                let mockName = "";
                if (provider === 'Facebook') mockName = "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ (Facebook)";
                else if (provider === 'Google') mockName = "Somchai (Google Account)";
                else mockName = "Professional User (LinkedIn)";
                
                loginSuccess(mockName);
            });
        }

        // Helper: Fake Loading
        function showLoading(callback) {
            const loader = document.getElementById('loading-overlay');
            loader.classList.remove('hidden'); // Show spinner
            
            setTimeout(() => {
                loader.classList.add('hidden'); // Hide spinner
                callback();
            }, 1500); // Wait 1.5 seconds
        }

        function loginSuccess(username) {
            appData.user = username;
            saveData();
            
            // Transition
            document.getElementById('login-wrapper').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            document.getElementById('display-user').innerText = username;
            
            renderAll();
        }

        function logout() { location.reload(); }

        // --- CORE BUILD FLOW LOGIC ---
        function saveData() {
            try {
                // Updated key to v5
                localStorage.setItem('buildflow_pro_data_v5', JSON.stringify(appData));
            } catch (e) {
                alert("‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ï‡πá‡∏°! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏á");
            }
            renderAll();
        }

        function renderAll() {
            // Header
            document.getElementById('display-project-name').innerText = appData.projectName;
            document.getElementById('display-budget').innerText = '‡∏ø' + parseInt(appData.budget).toLocaleString();

            // Progress
            const totalTasks = appData.tasks.length;
            const completedTasks = appData.tasks.filter(t => t.completed).length;
            const progress = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);
            document.getElementById('display-progress').innerText = progress + '%';
            document.getElementById('progress-bar-fill').style.width = progress + '%';
            document.getElementById('display-pending-tasks').innerText = totalTasks - completedTasks;

            // 1. Tasks
            const taskContainer = document.getElementById('task-list-container');
            taskContainer.innerHTML = '';
            
            if (appData.tasks.length === 0) {
                taskContainer.innerHTML = '<div style="padding:20px; text-align:center; color:#aaa;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>';
            } else {
                appData.tasks.forEach((task, index) => {
                    const isChecked = task.completed ? 'checked' : '';
                    const nameClass = task.completed ? 'task-name completed' : 'task-name';
                    
                    let taskImageHtml = '';
                    if (task.image) {
                        taskImageHtml = `
                            <div class="img-wrapper">
                                <img src="${task.image}" class="task-img-thumb" onclick="openImageViewer('${task.image}')">
                                <span class="delete-badge" onclick="deleteTaskImage(${index})" title="‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">‚úï</span>
                            </div>
                        `;
                    }

                    const html = `
                        <div class="task-item">
                            <div class="task-left">
                                <input type="checkbox" onchange="toggleTask(${index})" ${isChecked}>
                                <span class="${nameClass}">${task.name}</span>
                                ${taskImageHtml}
                            </div>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <button onclick="triggerTaskUpload(${index})" class="btn-icon" title="‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"><i class="fas fa-camera"></i></button>
                                <button onclick="deleteTask(${index})" class="btn-icon" style="color:#ff4d4d;" title="‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `;
                    taskContainer.innerHTML += html;
                });
            }

            // 2. Photo Feed
            const photoFeed = document.getElementById('photo-feed');
            photoFeed.innerHTML = '';
            appData.sitePhotos.forEach((src, index) => {
                const html = `
                    <div class="photo-card" style="background-image:url('${src}')" onclick="openImageViewer('${src}')">
                        <i class="fas fa-trash card-delete-btn" onclick="deleteSitePhoto(event, ${index})"></i>
                    </div>
                `;
                photoFeed.innerHTML += html;
            });

            // 3. Documents
            const docContainer = document.getElementById('doc-list-container');
            docContainer.innerHTML = '';
            appData.documents.forEach((doc, index) => {
                let icon = 'fa-file';
                let color = '#888';
                if(doc.type.includes('pdf')) { icon = 'fa-file-pdf'; color = '#e74c3c'; }
                else if(doc.type.includes('xls') || doc.type.includes('sheet')) { icon = 'fa-file-excel'; color = '#28a745'; }
                else if(doc.type.includes('word') || doc.type.includes('doc')) { icon = 'fa-file-word'; color = '#3498db'; }
                else if(doc.type.includes('image')) { icon = 'fa-file-image'; color = '#f39c12'; }

                const html = `
                    <div class="doc-card" onclick="openDocument(${index})">
                        <i class="fas fa-trash card-delete-btn" onclick="deleteDoc(event, ${index})"></i>
                        <div class="doc-icon"><i class="fas ${icon}" style="color:${color};"></i></div>
                        <h4 style="word-break: break-all; font-size:0.9rem;">${doc.name}</h4>
                        <p style="font-size:0.8rem; color:#888;">${doc.size}</p>
                    </div>
                `;
                docContainer.innerHTML += html;
            });

            // 4. Plan
            const planImg = document.getElementById('plan-image');
            if (appData.planImage) {
                planImg.src = appData.planImage;
                planImg.classList.remove('hidden');
                document.getElementById('remove-plan-btn').classList.remove('hidden');
                document.getElementById('no-plan-msg').classList.add('hidden');
            } else {
                planImg.classList.add('hidden');
                document.getElementById('remove-plan-btn').classList.add('hidden');
                document.getElementById('no-plan-msg').classList.remove('hidden');
            }
        }

        // --- ACTIONS ---

        function handleDocUpload(input) {
            const file = input.files[0];
            if(file) {
                if(file.size > 2 * 1024 * 1024) { 
                    alert("‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 2MB ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Demo)");
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    let sizeStr = (file.size < 1024 * 1024) ? (file.size/1024).toFixed(1)+" KB" : (file.size/(1024*1024)).toFixed(1)+" MB";
                    appData.documents.push({
                        name: file.name,
                        size: sizeStr,
                        type: file.type || file.name.split('.').pop(),
                        data: e.target.result
                    });
                    saveData();
                    input.value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteDoc(event, index) {
            event.stopPropagation();
            if(confirm("‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
                appData.documents.splice(index, 1);
                saveData();
            }
        }

        function openDocument(index) {
            const doc = appData.documents[index];
            if(!doc.data) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå");
            const win = window.open();
            if(doc.type.includes('image') || doc.type.includes('pdf')) {
                win.document.write('<iframe src="' + doc.data + '" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>');
            } else {
                const link = document.createElement('a');
                link.href = doc.data;
                link.download = doc.name;
                link.click();
            }
        }

        function triggerTaskUpload(index) {
            currentTaskIndexForUpload = index;
            document.getElementById('task-photo-input').click();
        }
        function saveTaskPhoto(input) {
            const file = input.files[0];
            if (file) {
                if(file.size > 3000000) return alert("‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ");
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (currentTaskIndexForUpload !== null) {
                        appData.tasks[currentTaskIndexForUpload].image = e.target.result;
                        saveData();
                        input.value = '';
                    }
                };
                reader.readAsDataURL(file);
            }
        }
        function deleteTaskImage(index) {
            if(confirm("‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ?")) {
                appData.tasks[index].image = null;
                saveData();
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId + '-section').classList.add('active');
            document.getElementById('nav-' + tabId).classList.add('active');
        }
        function openSettings() {
            document.getElementById('edit-project-name').value = appData.projectName;
            document.getElementById('edit-project-budget').value = appData.budget;
            document.getElementById('settings-modal').classList.remove('hidden');
        }
        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }
        function saveSettings() {
            appData.projectName = document.getElementById('edit-project-name').value;
            appData.budget = document.getElementById('edit-project-budget').value;
            saveData();
            closeSettings();
        }
        function toggleTask(index) { appData.tasks[index].completed = !appData.tasks[index].completed; saveData(); }
        function addTaskPrompt() {
            const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà:");
            if(name) { appData.tasks.push({ id: Date.now(), name: name, completed: false, image: null }); saveData(); }
        }
        function deleteTask(index) { if(confirm("‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?")) { appData.tasks.splice(index, 1); saveData(); } }
        
        function handlePhotoUpload(input) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    appData.sitePhotos.unshift(e.target.result);
                    saveData();
                    input.value = '';
                };
                reader.readAsDataURL(file);
            }
        }
        function deleteSitePhoto(event, index) {
            event.stopPropagation();
            if(confirm("‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ?")) { appData.sitePhotos.splice(index, 1); saveData(); }
        }
        function handlePlanUpload(input) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    appData.planImage = e.target.result;
                    saveData();
                };
                reader.readAsDataURL(file);
            }
        }
        function removePlan() { if(confirm("‡∏•‡∏ö‡πÅ‡∏õ‡∏•‡∏ô‡∏ô‡∏µ‡πâ?")) { appData.planImage = null; saveData(); } }
        function openImageViewer(src) {
            document.getElementById('image-viewer-content').src = src;
            document.getElementById('image-viewer-modal').classList.remove('hidden');
        }
        function closeImageViewer() { document.getElementById('image-viewer-modal').classList.add('hidden'); }

        init();
    </script>
</body>
</html>